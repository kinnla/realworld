<!DOCTYPE html>
<html>
  <head>
    <title>Hello, WebVR! - A-Frame</title>
    <meta name="RealWorld" content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no,maximum-scale=1">
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
    <script src="tree.js"></script>
    <script src="camera-logger.js"></script>
    <script src="viewpoint.js"></script>
  </head>
  <!-- @todo: limit rendered frames per second at THREE.js (fan spins fast, distracts user) -->

<!--   <script>
    
    // define viewpoints and register listener. @todo: refactor this with the new viewpoint logic from aframe-extras
    AFRAME.registerComponent('cursor-listener', {
      init: function () {
        var viewPositions = ["5 1.8 12.5", "-5 1.8 -1", "5 1.8 -29", "0 40 -5"];
        var viewRotations = ["0 0 0", "0 0 0", "0 270 135", "0 0 -90"];
        var currentViewIndex = 0;

        for (var i = 1; i<=6; i++) {
          var background= this.el.sceneEl.querySelector("#background" + i);
          var camera= this.el.sceneEl.querySelector("#camera");
              background.addEventListener('click', function(evt){
              camera.setAttribute('position', viewPositions[++currentViewIndex % viewPositions.length]);
              camera.setAttribute('rotation', viewRotations[currentViewIndex % viewRotations.length]);
          });
        }
      }
    });
  </script> -->

  
  <body>
    
    <!-- scene with fog -->
    <a-scene antialias="true" fog="type: exponential; color: #444; density: 0.005">
      
      <!-- load assets. For performance, it is recommended to load each image only once and before rendering starts -->
      <a-assets>
        <img id="top" src="https://cdn.glitch.com/610fa97a-f228-4f68-a76f-dacec3a94fa1%2Fnebula.jpg?1532545290299"/>
        <img id="bottom" src="https://cdn.glitch.com/610fa97a-f228-4f68-a76f-dacec3a94fa1%2Fsea_mirror.gif?1532545290763"/>
        <img id="side" src="https://cdn.glitch.com/610fa97a-f228-4f68-a76f-dacec3a94fa1%2Fseasky.jpg?1532545290989"/>
        <img id="wall" src="https://cdn.glitch.com/610fa97a-f228-4f68-a76f-dacec3a94fa1%2Fziegel.jpg?1532545289954"/>
        <img id="roof" src="https://cdn.glitch.com/610fa97a-f228-4f68-a76f-dacec3a94fa1%2Fziegel-dach.jpg?1532545289854"/>
        <img id="person10" src="https://cdn.glitch.com/610fa97a-f228-4f68-a76f-dacec3a94fa1%2FPerson10.jpg?1532545289055"/>
        <img id="person12" src="https://cdn.glitch.com/610fa97a-f228-4f68-a76f-dacec3a94fa1%2FPerson12.jpg?1532545288641"/>
      </a-assets>

      <!-- Camera and movement control via checkpoints. Provided by aframe-extras. -->
      <!-- @todo: move rig to the origin 0 0 0, center world around it -->
      <a-entity id="rig" movement-controls="controls: checkpoint" checkpoint-controls="mode: animate" position="5 0 12.5" >
        <a-entity id="camera" camera
                  look-controls="pointerLockEnabled: true"
                  position="0 1.6 0"
                  camera-logger>
          <a-entity cursor="fuse: true"
                    position="0 0 -1"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.025;"
                    material="color: #AAC; shader: flat;"
                    raycaster="far: 20; interval: 1000; objects: .clickable">
            <a-animation begin="click" easing="ease-in" attribute="scale" dur="150"
               fill="forwards" from="0.1 0.1 0.1" to="1 1 1"></a-animation>
            <a-animation begin="cursor-fusing" easing="ease-in" attribute="scale" dur="1500"
               fill="backwards" from="1 1 1" to="0.1 0.1 0.1"></a-animation>
          </a-entity>
        </a-entity>
      </a-entity>
      
      
      
      <!-- alternative camera with keyboard control (for debuging) -->
<!--       <a-entity position="5 0 12.5" rotation="0 0 0"><a-camera camera-logger><a-cursor></a-cursor></a-camera></a-entity>
      <a-box position="5 1.8 12.5" color="red" material="emissive: red"></a-box>
 -->
      <!-- Light -->
      <a-entity light="type: directional; color: #F66; intensity: 1" position="1 0.5 1"></a-entity>
            
      <!-- Background. We are in a cube, but initially this fact is hidden by the fog surrounding us -->
      <a-entity>
        <a-image id="background1" src="#top" height="1000" width="1000" rotation="90 0 0" position="0 500 0"></a-image>
        <a-image id="background2" src="#bottom" height="1000" width="1000" rotation="-90 0 0" position="0 -500 0"></a-image>
        <a-image id="background3" src="#side" height="1000" width="1000" rotation="0 0 0" position="0 0 -500"></a-image>
        <a-image id="background4" src="#side" height="1000" width="1000" rotation="0 90 0" position="-500 0 0"></a-image>
        <a-image id="background5" src="#side" height="1000" width="1000" rotation="0 -90 0" position="500 0 0"></a-image>
        <a-image id="background6" src="#side" height="1000" width="1000" rotation="0 180 0" position="0 0 500"></a-image>
      </a-entity>

      <!-- welcome text -->
      <a-entity position="5 2 9">
        <a-entity position="0 0 0" text="value: Welcome to the Real World; width: 8; opacity: 0">
          <a-animation attribute="text.opacity" delay="2000" dur="5000" from="0" to="1" easing="ease-out-sine"></a-animation>
          <a-animation attribute="text.opacity" delay="7000" dur="5000" from="1" to="0" easing="ease-in-sine"></a-animation>
        </a-entity>
        <a-entity position="0 -0.8 0" text="value: Finde den Weg durch den Wald; width: 8; opacity: 0">
          <a-animation attribute="text.opacity" delay="7000" dur="5000" from="0" to="1" easing="ease-out-sine"></a-animation>
          <a-animation attribute="text.opacity" delay="12000" dur="5000" from="1" to="0" easing="ease-in-sine"></a-animation>
        </a-entity>
      </a-entity>

      <!-- checkpoints -->
      <a-entity id="viewpoints">
        <a-entity id="vp_forest1" viewpoint="status: enabled; neighbours: {#vp_forest2}" position="-3 1.6 10"></a-entity>
        <a-entity id="vp_forest2" viewpoint="neighbours: {#vp_forest1, #vp_forest3}" position="0 1.6 10"></a-entity>
        <a-entity id="vp_forest3" viewpoint="neighbours: {#vp_forest2}" position="3 1.6 10"></a-entity>
      </a-entity>
      
      <!-- First Island @todo: material bearbeiten, dass es mehr nach Waldboden aussieht (weniger metallisch, Licht schluckend) -->
      <a-box position="5 0 -11" width="23" height="0.1" depth="43" color="#783">
        
        <a-entity id="house" position="-1 0 -11">
          <a-box material="src: #wall" position="0 1 0" width="4" height="2" depth="4"></a-box> 
          <a-box position="-0.5 5 0" width="0.5" height="1.5" depth="0.5" color="#ddd"></a-box> 
          <a-cylinder material="src: #roof; repeat: 10 10" height="4.2" radius="2.5" rotation="-90 0 0" segments-radial="3" position="0 3 0" ></a-cylinder> 
	        <a-image src="#person12" position="2.05 1 0.5" scale="1.2" rotation="0 90 0"></a-image>
          
<!--             # Fenster mit Person 12
    	    Transform {
    	      translation -0.8 2 2
    	      children 
		      [
		
			     Transform {
				      translation 0 0 0
				      children LOD { 
						  
						  range	[10, 20]
						  level	[
							  Shape	 { 
        						 appearance Appearance {	   
        					    	texture ImageTexture { 
      	    			    			url "Person12.jpg"
      	    			    			repeatS FALSE  
      	    			    			repeatT FALSE 
        				    			}
	    			    			}
        			    			geometry Box {size 1.8 1.8 0.01} 
    			    			}
							  Shape	 { 
        						 appearance Appearance {	   
        					    	texture ImageTexture { 
      	    			    			url "Person10.jpg"
      	    			    			repeatS FALSE  
      	    			    			repeatT FALSE 
        				    			}
	    			    			}
        			    			geometry Box {size 1.8 1.8 0.01} 
    			    			}
							  Shape	 { 
        						 appearance Appearance {	   
        					    	texture ImageTexture { 
      	    			    			url "Person11.jpg"
      	    			    			repeatS FALSE  
      	    			    			repeatT FALSE 
        				    			}
	    			    			}
        			    			geometry Box {size 1.8 1.8 0.01} 
    			    			}
							]
						}
				
			    }
           -->
          
        </a-entity>
        
        
        <!-- Forest @todo: procedural generation of forest, or reading coordinates from a file/ from an array -->
        <a-entity id="forest" position="-5 0 10" visible="true">
          <a-entity tree="height: 6" position="16.1 0 11"></a-entity>
          <a-entity tree position="13 0 10"></a-entity>
          <a-entity tree position="10 0 9"></a-entity>
          <a-entity tree="height: 6" position="16 0 8.2"></a-entity>
          <a-entity tree position="13 0 7"></a-entity>
          <a-entity tree="height: 7" position="16 0 5.1"></a-entity>
          <a-entity tree position="11 0 3"></a-entity>
          <a-entity tree="height: 6" position="16.2 0 2.1"></a-entity>
          <a-entity tree position="13 0 -11"></a-entity>
          <a-entity tree="height: 7" position="16.1 0 -9.9"></a-entity>
          <a-entity tree position="10 0 -9"></a-entity>
          <a-entity tree position="13 0 -8"></a-entity>
          <a-entity tree="height: 8" position="16 0 -7.1"></a-entity>
          <a-entity tree="height: 10" position="16 0 -3.9"></a-entity>
          <a-entity tree position="10 0 -3"></a-entity>
          <a-entity tree="height: 7" position="16.1 0 -1.1"></a-entity>
          <a-entity tree position="10 0 -20"></a-entity>
          <a-entity tree position="13 0 -19"></a-entity>
          <a-entity tree="height: 9" position="16.1 0 -18.1"></a-entity>
          <a-entity tree position="10 0 -17"></a-entity>
          <a-entity tree position="13 0 -16"></a-entity>
          <a-entity tree="height: 7" position="16 0 -15.2"></a-entity>
          <a-entity tree position="13 0 -13"></a-entity>
          <a-entity tree="height: 7" position="16.1 0 -12.1"></a-entity>
          <a-entity tree="height: 7" position="-6.1 0 11"></a-entity>
          <a-entity tree position="-3 0 10"></a-entity>
          <a-entity tree position="0 0 9"></a-entity>
          <a-entity tree="height: 8" position="-6 0 8.1"></a-entity>
          <a-entity tree position="-3 0 7"></a-entity>
          <a-entity tree position="0 0 6"></a-entity>
          <a-entity tree="height: 6" position="-5.9 0 5.2"></a-entity>
          <a-entity tree position="-3 0 4"></a-entity>
          <a-entity tree position="0 0 3"></a-entity>
          <a-entity tree="height: 7" position="-6.1 0 2.1"></a-entity>
          <a-entity tree position="0 0 -12"></a-entity>
          <a-entity tree position="-3 0 -11"></a-entity>
          <a-entity tree="height: 4" position="-6.1 0 -10.3"></a-entity>
          <a-entity tree="height: 7" position="-6.2 0 -7.1"></a-entity>
          <a-entity tree position="0 0 -6"></a-entity>
          <a-entity tree="height: 8" position="-6 0 -4.2"></a-entity>
          <a-entity tree position="0 0 -3"></a-entity>
          <a-entity tree position="-6.1 0 -1.1"></a-entity>
          <a-entity tree position="0 0 -20"></a-entity>
          <a-entity tree position="-3 0 -19"></a-entity>
          <a-entity tree="height: 8" position="-5.9 0 -18.3"></a-entity>
          <a-entity tree position="0 0 -17"></a-entity>
          <a-entity tree position="-3 0 -16"></a-entity>
          <a-entity tree="height: 5" position="-6.2 0 -15.2"></a-entity>
          <a-entity tree position="0 0 -14"></a-entity>
          <a-entity tree position="-3 0 -13"></a-entity>
          <a-entity tree="height: 4" position="-6.1 0 -12.1"></a-entity>
          <a-entity tree position="7.5 0 11"></a-entity>
          <a-entity tree position="3 0 8"></a-entity>
          <a-entity tree position="4.5 0 6"></a-entity>
          <a-entity tree position="6 0 5"></a-entity>
          <a-entity tree position="3 0 4"></a-entity>
          <a-entity tree position="4.5 0 2"></a-entity>
          <a-entity tree position="6 0 1"></a-entity>
          <a-entity tree position="3 0 -12"></a-entity>
          <a-entity tree position="7.5 0 -8"></a-entity>
          <a-entity tree position="3 0 -8"></a-entity>
          <a-entity tree position="6 0 -7"></a-entity>
          <a-entity tree position="4.5 0 -6"></a-entity>
          <a-entity tree position="3 0 -4"></a-entity>
          <a-entity tree position="7.5 0 -1"></a-entity>
          <a-entity tree position="7.5 0 -19.5"></a-entity>
          <a-entity tree position="3 0 -16"></a-entity>
          <a-entity tree position="6 0 -15"></a-entity>
          <a-entity tree position="4.5 0 -14"></a-entity>
          <a-entity tree position="7.5 0 -13"></a-entity>
          <a-entity tree position="3 0 -12"></a-entity>
          <a-entity tree position="3 0 -16"></a-entity>
          <a-entity tree position="-5 0 -21"></a-entity>
          <a-entity tree position="-2 0 -23"></a-entity>
          <a-entity tree position="-5 0 -26"></a-entity>
          <a-entity tree position="-2 0 -28"></a-entity>
          <a-entity tree position="-6 0 -30"></a-entity>
          <a-entity tree position="5 0 -26"></a-entity>
          <a-entity tree position="9 0 -28"></a-entity>
          <a-entity tree position="12 0 -22"></a-entity>
          <a-entity tree position="15 0 -24"></a-entity>
          <a-entity tree position="13 0 -28"></a-entity>
          <a-entity tree position="11 0 -30"></a-entity>
          <a-entity tree position="16 0 -27"></a-entity>
          <a-entity tree position="8 0 -31"></a-entity>
          <a-entity tree position="5 0 -31"></a-entity>
          <a-entity tree position="2 0 -31"></a-entity>
          <a-entity tree position="-1 0 -31"></a-entity>
          <a-entity tree position="-4 0 -31"></a-entity>
          <a-entity tree="height: 1" position="2 0 2"></a-entity>
          <a-entity tree="height: 2" position="4 0 3"></a-entity>
          <a-entity tree="height: 3" position="7 0 1"></a-entity>
          <a-entity tree="height: 4" position="1 0 6"></a-entity>
          <a-entity tree="height: 5" position="10 0 5"></a-entity>
          <a-entity tree="height: 6" position="-4 0 5"></a-entity>
          <a-entity tree="height: 7; crown: 4" position="-1 0 -5"></a-entity>
          <a-entity tree="height: 8" position="-6 0 -2"></a-entity>
          <a-entity tree="height: 9" position="4 0 4"></a-entity>
          <a-entity tree="height: 1" position="-1 0 -1"></a-entity>
          <a-entity tree="height: 4" position="2.5 0 2"></a-entity>
          <a-entity tree="height: 7" position="4.5 0 3"></a-entity>
          <a-entity tree="height: 6" position="7.5 0 1"></a-entity>
          <a-entity tree="height: 8" position="1.5 0 6"></a-entity>
          <a-entity tree="height: 4" position="10.5 0 5"></a-entity>
          <a-entity tree="height: 3" position="-4.5 0 5"></a-entity>
          <a-entity tree="height: 11; crown: 4" position="-1.5 0 -5"></a-entity>
          <a-entity tree="height: 6" position="6.5 0 -2"></a-entity>
          <a-entity tree="height: 4" position="4.5 0 4"></a-entity>
          <a-entity tree="height: 9" position="-1.5 0 -1"></a-entity>
          <a-entity tree="height: 1" position="2 0 2"></a-entity>
          <a-entity tree="height: 2" position="4 0 3"></a-entity>
          <a-entity tree="height: 3" position="7 0 1"></a-entity>
          <a-entity tree="height: 4" position="1 0 6"></a-entity>
          <a-entity tree="height: 5" position="10 0 5"></a-entity>
          <a-entity tree="height: 6" position="-4 0 5"></a-entity>
          <a-entity tree="height: 7; crown: 4" position="-1 0 -5"></a-entity>
          <a-entity tree="height: 8" position="-6 0 -2"></a-entity>
          <a-entity tree="height: 9" position="4 0 4"></a-entity>
          <a-entity tree="height: 1" position="-1 0 -1"></a-entity>
          <a-entity tree="height: 4" position="2.5 0 2"></a-entity>
          <a-entity tree="height: 7" position="4.5 0 3"></a-entity>
          <a-entity tree="height: 6" position="7.5 0 1"></a-entity>
          <a-entity tree="height: 8" position="1.5 0 6"></a-entity>
          <a-entity tree="height: 4" position="10.5 0 5"></a-entity>
          <a-entity tree="height: 3" position="-4.5 0 5"></a-entity>
          <a-entity tree="height: 11; crown: 4" position="-1.5 0 -5"></a-entity>
          <a-entity tree="height: 6" position="6.5 0 -2"></a-entity>
          <a-entity tree="height: 4" position="4.5 0 4"></a-entity>
          <a-entity tree="height: 9" position="-1.5 0 -1"></a-entity>
          <a-entity tree="height: 5" position="8 0 -7"></a-entity>
        </a-entity>
      
      </a-box>
	  
      <!-- adjust camera and rig altitude for Oculus go -->
<!--       <script>
        function isOculusGo () {
          return /Pacific Build.+OculusBrowser.+SamsungBrowser.+Mobile VR/i.test(window.navigator.userAgent);
        }
        
         if ( isOculusGo() ) {
          document.querySelector("#camera").setAttribute('position', "0 1.6 0");
          document.querySelector("#rig").setAttribute('position', "5 0 12.5");
          
          let checkpoints = document.querySelector("#checkpoints").children;
          for (const point of checkpoints) {
            point.setAttribute('checkpoint', 'offset: 0 -1.6 0');
          }
        }
        
      </script> -->
    </a-scene>
    
  </body>
</html>